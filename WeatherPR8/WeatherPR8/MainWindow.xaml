<Window x:Class="WeatherPR8.MainWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:local="clr-namespace:WeatherPR8"
        mc:Ignorable="d"
        Title="Прогноз погоды - Gismeteo" 
        Height="750" 
        Width="1200"
        WindowStartupLocation="CenterScreen"
        TextElement.Foreground="{DynamicResource MaterialDesignBody}"
        Background="{DynamicResource MaterialDesignPaper}"
        FontFamily="Segoe UI">

    <Window.Resources>
        <!-- Стиль для DataGrid -->
        <Style TargetType="DataGridCell">
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="FocusVisualStyle" Value="{x:Null}"/>
            <Setter Property="Padding" Value="10"/>
            <Setter Property="FontSize" Value="12"/>
        </Style>

        <!-- Конвертер для цвета температуры 
        <local:TemperatureToColorConverter x:Key="TemperatureColorConverter"/>-->
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- Шапка приложения -->
        <Border Grid.Row="0" 
                Background="{DynamicResource PrimaryHueMidBrush}"
                CornerRadius="8"
                Margin="0,0,0,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Иконка приложения -->
                <materialDesign:PackIcon Grid.Column="0"
                                        Kind="WeatherPartlyCloudy" 
                                        Width="40" 
                                        Height="40" 
                                        Foreground="White"
                                        Margin="20,15"/>

                <!-- Заголовок -->
                <StackPanel Grid.Column="1" 
                           VerticalAlignment="Center">
                    <TextBlock Text="Прогноз погоды" 
                              FontSize="24" 
                              FontWeight="Bold"
                              Foreground="White"/>
                    <TextBlock Text="Gismeteo API" 
                              FontSize="14"
                              Foreground="{DynamicResource PrimaryHueLightBrush}"
                              Margin="0,2,0,0"/>
                </StackPanel>

                <!-- Текущее время -->
                <StackPanel Grid.Column="2" 
                           Orientation="Horizontal"
                           VerticalAlignment="Center"
                           Margin="0,0,20,0">
                    <materialDesign:PackIcon Kind="Clock" 
                                           Width="20" 
                                           Height="20" 
                                           Foreground="White"
                                           Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding CurrentTime, StringFormat='HH:mm'}" 
                              Foreground="White"
                              FontSize="14"
                              FontWeight="Medium"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Панель управления -->
        <Border Grid.Row="1" 
                CornerRadius="8" 
                Background="{DynamicResource MaterialDesignCardBackground}"
                Padding="16"
                Margin="0,0,0,20">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <!-- Выбор города -->
                <StackPanel Grid.Column="0" Orientation="Vertical" Margin="0,0,20,0">
                    <TextBlock Text="Город:" 
                              Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                              Margin="0,0,0,4"/>
                    <ComboBox x:Name="CityComboBox"
                             materialDesign:HintAssist.Hint="Выберите город"
                             Style="{StaticResource MaterialDesignFloatingHintComboBox}"
                             Width="200"
                             FontSize="14"
                             ItemsSource="{Binding Cities}"
                             SelectedItem="{Binding SelectedCity, Mode=TwoWay}"
                             IsEditable="True">
                        <ComboBox.ItemTemplate>
                            <DataTemplate>
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="City" 
                                                           Width="16" 
                                                           Height="16" 
                                                           Margin="0,0,8,0"/>
                                    <TextBlock Text="{Binding}" VerticalAlignment="Center"/>
                                </StackPanel>
                            </DataTemplate>
                        </ComboBox.ItemTemplate>
                    </ComboBox>
                </StackPanel>

                <!-- Поле для API ключа -->
                <StackPanel Grid.Column="1" Orientation="Vertical" Margin="0,0,20,0">
                    <TextBlock Text="API Key (для Gismeteo):" 
                              Style="{StaticResource MaterialDesignSubtitle2TextBlock}"
                              Margin="0,0,0,4"/>
                    <PasswordBox x:Name="ApiKeyBox"
                                materialDesign:HintAssist.Hint="Введите API ключ"
                                Style="{StaticResource MaterialDesignFloatingHintPasswordBox}"
                                FontSize="14"
                                Width="300"/>
                </StackPanel>

                <!-- Кнопка получения погоды -->
                <Button Grid.Column="2"
                       Content="Получить погоду"
                       Style="{StaticResource MaterialDesignRaisedButton}"
                       Height="45"
                       Width="140"
                       Margin="0,0,16,0"
                       Click="GetWeatherButton_Click"
                       IsEnabled="{Binding IsNotLoading}">
                    <Button.ContentTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="CloudDownload" 
                                                       Width="20" 
                                                       Height="20" 
                                                       Margin="0,0,8,0"/>
                                <TextBlock Text="Получить" 
                                          VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>

                <!-- Кнопка обновления -->
                <Button Grid.Column="3"
                       Content="Обновить"
                       Style="{StaticResource MaterialDesignOutlinedButton}"
                       Height="45"
                       Width="100"
                       Margin="0,0,16,0"
                       Click="RefreshButton_Click"
                       IsEnabled="{Binding IsNotLoading}">
                    <Button.ContentTemplate>
                        <DataTemplate>
                            <StackPanel Orientation="Horizontal">
                                <materialDesign:PackIcon Kind="Refresh" 
                                                       Width="20" 
                                                       Height="20" 
                                                       Margin="0,0,8,0"/>
                                <TextBlock Text="Обновить" 
                                          VerticalAlignment="Center"/>
                            </StackPanel>
                        </DataTemplate>
                    </Button.ContentTemplate>
                </Button>

                <!-- Индикатор загрузки -->
                <StackPanel Grid.Column="4" 
                           Orientation="Horizontal"
                           VerticalAlignment="Center"
                           Visibility="{Binding IsLoading, Converter={StaticResource BooleanToVisibilityConverter}}">
                    <ProgressBar IsIndeterminate="True" 
                                Width="80" 
                                Height="6"
                                Margin="0,0,8,0"/>
                    <TextBlock Text="Загрузка..." 
                              VerticalAlignment="Center"
                              Style="{StaticResource MaterialDesignBody2TextBlock}"/>
                </StackPanel>
            </Grid>
        </Border>

        <!-- Таблица с данными погоды -->
        <Border Grid.Row="2" 
                CornerRadius="8" 
                Background="{DynamicResource MaterialDesignCardBackground}"
                Padding="0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- Заголовок таблицы -->
                <Border Grid.Row="0" 
                        Background="{DynamicResource PrimaryHueLightBrush}" 
                        CornerRadius="8,8,0,0"
                        Height="50">
                    <Grid>
                        <TextBlock Text="Данные о погоде" 
                                  FontSize="16" 
                                  FontWeight="Bold"
                                  VerticalAlignment="Center"
                                  HorizontalAlignment="Left"
                                  Margin="20,0,0,0"
                                  Foreground="White"/>

                        <StackPanel Orientation="Horizontal" 
                                   HorizontalAlignment="Right" 
                                   VerticalAlignment="Center"
                                   Margin="0,0,20,0">
                            <materialDesign:PackIcon Kind="Database" 
                                                   Width="20" 
                                                   Height="20" 
                                                   Foreground="White"
                                                   Margin="0,0,8,0"/>
                            <TextBlock Text="{Binding WeatherItems.Count, StringFormat='{}{0} записей'}" 
                                      Foreground="White"
                                      VerticalAlignment="Center"/>
                        </StackPanel>
                    </Grid>
                </Border>

                <!-- DataGrid -->
                <DataGrid x:Name="WeatherDataGrid" 
                         Grid.Row="1"
                         AutoGenerateColumns="False"
                         IsReadOnly="True"
                         HeadersVisibility="Column"
                         BorderThickness="0"
                         RowHeight="50"
                         SelectionMode="Single"
                         Background="Transparent"
                         GridLinesVisibility="None"
                         ItemsSource="{Binding WeatherItems}"
                         materialDesign:DataGridAssist.CellPadding="10,8,10,8"
                         materialDesign:DataGridAssist.ColumnHeaderPadding="16,8,16,8">

                    <DataGrid.Columns>
                        <!-- Дата и время -->
                        <DataGridTemplateColumn Header="Дата и время" Width="1.2*">
                            <DataGridTemplateColumn.HeaderTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="CalendarClock" 
                                                               Width="16" 
                                                               Height="16" 
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="Дата и время" 
                                                  FontWeight="SemiBold"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.HeaderTemplate>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                                        <materialDesign:PackIcon Kind="Calendar" 
                                                               Width="16" 
                                                               Height="16" 
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="{Binding DateTime}" 
                                                  VerticalAlignment="Center"
                                                  FontSize="12"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Температура -->
                        <DataGridTemplateColumn Header="Температура" Width="*">
                            <DataGridTemplateColumn.HeaderTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Thermometer" 
                                                               Width="16" 
                                                               Height="16" 
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="Температура (°C)" 
                                                  FontWeight="SemiBold"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.HeaderTemplate>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" 
                                               VerticalAlignment="Center">
                                        <Border Background="{Binding Temperature, Converter={StaticResource TemperatureColorConverter}}"
                                                CornerRadius="4"
                                                Padding="8,4"
                                                Margin="4,0">
                                            <TextBlock Text="{Binding Temperature, StringFormat='{}{0}°C'}" 
                                                      FontSize="12"
                                                      FontWeight="Bold"
                                                      Foreground="White"
                                                      HorizontalAlignment="Center"/>
                                        </Border>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Давление -->
                        <DataGridTemplateColumn Header="Давление" Width="*">
                            <DataGridTemplateColumn.HeaderTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="Speedometer" 
                                                               Width="16" 
                                                               Height="16" 
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="Давление (мм рт.ст.)" 
                                                  FontWeight="SemiBold"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.HeaderTemplate>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" 
                                               VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Pressure}" 
                                                  FontSize="12"
                                                  FontWeight="SemiBold"
                                                  Margin="0,0,4,0"/>
                                        <TextBlock Text=" мм рт.ст." 
                                                  FontSize="10"
                                                  VerticalAlignment="Bottom"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Влажность -->
                        <DataGridTemplateColumn Header="Влажность" Width="*">
                            <DataGridTemplateColumn.HeaderTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="WaterPercent" 
                                                               Width="16" 
                                                               Height="16" 
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="Влажность (%)" 
                                                  FontWeight="SemiBold"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.HeaderTemplate>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" 
                                               VerticalAlignment="Center">
                                        <TextBlock Text="{Binding Humidity}" 
                                                  FontSize="12"
                                                  FontWeight="SemiBold"
                                                  Margin="0,0,4,0"/>
                                        <TextBlock Text="%" 
                                                  FontSize="10"
                                                  VerticalAlignment="Bottom"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>

                        <!-- Погодные условия -->
                        <DataGridTemplateColumn Header="Погодные условия" Width="1.5*">
                            <DataGridTemplateColumn.HeaderTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal">
                                        <materialDesign:PackIcon Kind="WeatherSunny" 
                                                               Width="16" 
                                                               Height="16" 
                                                               Margin="0,0,8,0"/>
                                        <TextBlock Text="Погодные условия" 
                                                  FontWeight="SemiBold"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.HeaderTemplate>
                            <DataGridTemplateColumn.CellTemplate>
                                <DataTemplate>
                                    <StackPanel Orientation="Horizontal" 
                                               VerticalAlignment="Center">
                                        <materialDesign:PackIcon Kind="{Binding WeatherIcon}" 
                                                               Width="24" 
                                                               Height="24" 
                                                               Margin="0,0,12,0"/>
                                        <TextBlock Text="{Binding Description}" 
                                                  FontSize="11"
                                                  TextWrapping="Wrap"
                                                  VerticalAlignment="Center"/>
                                    </StackPanel>
                                </DataTemplate>
                            </DataGridTemplateColumn.CellTemplate>
                        </DataGridTemplateColumn>
                    </DataGrid.Columns>

                    <DataGrid.RowStyle>
                        <Style TargetType="DataGridRow">
                            <Setter Property="Background" Value="Transparent"/>
                            <Setter Property="BorderThickness" Value="0"/>
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Background" 
                                            Value="{DynamicResource MaterialDesignRowHoverBackground}"/>
                                </Trigger>
                                <Trigger Property="IsSelected" Value="True">
                                    <Setter Property="Background" 
                                            Value="{DynamicResource PrimaryHueLightBrush}"/>
                                    <Setter Property="Foreground" Value="White"/>
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </DataGrid.RowStyle>

                </DataGrid>
            </Grid>
        </Border>

        <!-- Статус бар -->
        <StatusBar Grid.Row="3" 
                   Background="Transparent" 
                   Margin="0,20,0,0">
            <StatusBarItem HorizontalAlignment="Left">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="InformationOutline" 
                                           Width="16" 
                                           Height="16" 
                                           Margin="0,0,8,0"/>
                    <TextBlock x:Name="StatusText" 
                              Text="Выберите город и нажмите 'Получить погоду' для загрузки данных"/>
                </StackPanel>
            </StatusBarItem>
            <StatusBarItem HorizontalAlignment="Right">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Update" 
                                           Width="16" 
                                           Height="16" 
                                           Margin="0,0,8,0"/>
                    <TextBlock Text="{Binding LastUpdate, StringFormat='Последнее обновление: {0:dd.MM.yyyy HH:mm:ss}'}"/>
                </StackPanel>
            </StatusBarItem>
        </StatusBar>
    </Grid>
</Window>
